<style>
  .floors {
    display: none;
  }
  .floors.active {
    display: flex;
  }

  .input-field {
    position: relative;
    display: inline-block;
    overflow: hidden;
  }
  .input-field > input[type=text]{
    border: none;
    outline: none;
    color: #4070f4;
  }

  .underline-animation{
    transition: all 0.5s;
    /*display: inline-block;*/
    bottom: 0;
    left: -100%;
    position: absolute;
    width: 100%;
    height: 2px;
    background-color: #4070f4;
  }
  .input-field > input[type=text]:focus + .underline-animation{
    left: 0;
  }
</style>

<nav class="d-flex position-relative flex-row justify-content-between animate fadeInDown">
  <ul class="nav nav-pills p-1">
    <% for (let building in data.buildings) { %>
      <li class="nav-item">
        <button type="button" class="nav-link building" data-bs-toggle="pill"
          data-bs-target="#building-<%- building %>">
        <%- building %></button>
      </li>
    <% } %>
    <li class="nav-item input-field d-flex m-1">
      <input type="text" placeholder="新增大樓" id="newBuilding">
      <span class="underline-animation"></span>
    </li>
  </ul>
  <ul class="pagination mb-0">
    <li><button type="button" class="btn btn-success" onclick="addBuilding();">
      <i class="bx bx-plus"></i></button>
    </li>
    <li><button type="button" class="btn btn-danger" onclick="deleteBuilding();">
      <i class="bx bx-minus"></i></button>
    </li>
  </ul>
</nav>

<div class="tab-content">
  <% for (let building in data.buildings) { %>
    <nav class="tab-pane position-relative floors fade flex-row justify-content-between animate fadeInDown" id="building-<%- building %>">
    <ul class="nav nav-pills">
    <% for (let floor in data.buildings[building]) { %>
      <li class="nav-item">
        <button type="button"
          class="nav-link floor" data-bs-toggle="pill" 
            data-bs-target="#building-<%- building %>-floor-<%- floor %>">
              <%- floor %></button></li>
    <% } %>
      <li class="nav-item input-field d-flex m-1">
        <input type="text" placeholder="新增樓層" id="<%- building %>-newFloor">
        <span class="underline-animation"></span>
      </li>
    </ul>
    <ul class="pagination mb-0">
      <li><button type="button" class="btn btn-success" onclick="addFloor();">
        <i class="bx bx-plus"></i></button>
      </li>
      <li><button type="button" class="btn btn-danger" onclick="deleteFloor();">
        <i class="bx bx-minus"></i></button>
      </li>
    </ul>
    </nav>
  <% } %>
</div>

<div class="tab-content">
  <% for (let building in data.buildings) { %>
    <% for (let floor in data.buildings[building]) { %>
      <div class="tab-pane fade list-group classrooms" id="building-<%- building %>-floor-<%- floor %>">
        <% for (let i = 0; i < data.buildings[building][floor].length; i++) { %>
          <div class="list-group-item">
            <div class="d-flex flex-row justify-content-around align-items-center ">
              <h3 class="m-0"><%- data.buildings[building][floor][i] %></h3>
              <div>
                <button class="btn btn-lg btn-outline-warning"> 編輯 </button>
                <button class="btn btn-lg btn-outline-danger"> 移除 </button>
              </div>
            </div>
          </div>
        <% } %>
        <div class="d-grid">
          <button type="button" data-bs-toggle="modal" data-bs-target="#newClassroomModal" class="btn btn-outline-success text-center"> 新增教室 </button>
        </div>
      </div>
    <% } %>
  <% } %>
</div>


<!-- New Classroom Modal -->
<div class="modal fade" id="newClassroomModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="newClassroomModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="newClassroomModal"> 新增教室 </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col">
              <label for="name" class="form-label"> 教室名稱 </label>
              <input type="text" class="form-control" id="name">
            </div>
            <div class="col">
              <label for="capacity" class="form-label"> 教室容量 </label>
              <input type="number" class="form-control" id="capacity">
            </div>
          </div>
          <div class="row mb-3 mt-3">
            <div class="col-3">
              <label for="capacity" class="form-label"> 其他資訊 </label>
            </div>
            <div class="col">
              <input type="checkbox" class="form-check-input" id="computer">
              <label class="form-check-label" for="computer"> 電腦 </label>
            </div>
          </div>
          <table class="table table-striped" id="schedule">
            <thead>
              <tr>
                <th scope="col"> 節次 </th>
                <% for (let weekday of ["星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"]) { %>
                  <th scope="col"> <%- weekday %> </th>
                <% } %>
              </tr>
            </thead>
            <tbody>
              <% for (let period of Array(15).keys()) { %>
                <tr id="period-<%- period %>">
                <th scope="row"> <%- period %> </th>
                <% for (let day of Array(7).keys()) { %>
                  <td>
                    <input type="checkbox" class="btn-check" id="btn-check-<%- day+1 %>-<%- period %>" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="btn-check-<%- day+1 %>-<%- period %>"> 保留 </label>
                  </td>
                <% } %>
                </tr>
              <% } %>
            </tbody>
          </table>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="addClassroom();">Save changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Message Modal -->
<div class="modal fade" id="msgModal" tabindex="-1" aria-labelledby="msgModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="msgModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="msgModalBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<input id="csrfToken" type="hidden" name="_csrf" value="<%- csrfToken %>">

<script>
  var buildings = document.getElementsByClassName('building');
  var floors = document.getElementsByClassName('floor');
  var classrooms = document.getElementsByClassName("classrooms");
  for (let i = 0; i < buildings.length; i++) {
    buildings[i].addEventListener("click", function() {
      for (let j = 0; j < classrooms.length; j++) {
        classrooms[j].classList.remove("active");
        classrooms[j].classList.remove("show");
      }
      for(let j = 0; j < floors.length; j++) {
        floors[j].classList.remove("active");
      }
    });
  }
</script>